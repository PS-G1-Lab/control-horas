---
import { validateResponse, validateResult } from "../utils/form-validations"

import AlterHeader from "@/components/AlterHeader.astro"
import Border from "@/components/Border.astro"
import Button from "@/components/Button.astro"
import Footer from "@/components/Footer.astro"
import TextSidebar from "@/components/TextSidebar.astro"
import Layout from "@/layouts/Layout.astro"

const errors = {
	userCookie: "",
	role: "",
	server: "",
}

async function handleUserSignUp(e) {
	e.preventDefault()

	const { role } = e.target.elements

	const data = {
		userCookie: Astro.cookies.get("user").value.trim(),
		role: role.value.trim(),
	}

	if (typeof window !== "undefined" && typeof localStorage !== "undefined") {
		const localRole = localStorage.getItem("role")
		if (localRole !== data.role) {
			console.log(
				"¬°Atenci√≥n! üõë ¬°Este sistema est√° protegido por una muralla impenetrable! Los hackers encontrar√°n solo puertas cerradas. üö™üîí #SeguridadTotal"
			)
			return
		}
	}

	const formData = new FormData()
	formData.append("userCookie", data.userCookie)

	const res = await fetch("/api/resgiterInClass", {
		method: "POST",
		body: formData,
	})

	errors.server = await validateResponse(res)
	if (errors.server) return

	const result = await res.json()

	errors.server = validateResult(result)
	if (errors.server) return
}
---

<Layout
	title="GestionAppmos - La aplicaci√≥n de gesti√≥n horaria para clases particulares"
	description="La nueva aplicaci√≥n que va a revolucionar la forma de gestionarte los horarios para las clases particulares. Busca profesores, o date a conocer a nivel mundial."
>
	<AlterHeader />

	<section class="relative mt-3 flex">
		<!-- Men√∫ Hamburguesa para Dispositivos M√≥viles -->
		<div class="absolute left-0 top-0 z-50 sm:hidden">
			<button id="mobileMenuBtn" class="cursor-pointer p-4 text-2xl focus:outline-none">
				&#9776;
			</button>
		</div>

		<!-- Contenido del Men√∫ (√Åmbito) -->
		<aside
			id="menuSection"
			class="absolute mb-3 hidden w-1/2 border-r border-black bg-white p-4 md:block lg:relative lg:block lg:w-1/5"
		>
			<!-- Contenido del Men√∫ -->
			<div class="mb-4">
				<h3 class="mt-10 text-base font-bold">√Åmbito:</h3>
				<!-- To do bd -->
				<div class="space-y-2">
					<TextSidebar content="Inform√°tica" />
					<TextSidebar content="Ciencias" />
					<TextSidebar content="Literatura" />
					<TextSidebar content="Ingenier√≠a" />
					<TextSidebar content="Matem√°ticas" />
				</div>

				<!-- Contenido desplegable -->
				<div class="relative mt-4">
					<button
						id="dropdownBtn"
						class="flex cursor-pointer items-center font-bold focus:outline-none"
					>
						<span>10 m√°s</span>
						<svg
							id="dropdownIcon"
							xmlns="http://www.w3.org/2000/svg"
							class="ml-1 inline-block h-5 w-5 transform transition-transform duration-200"
							fill="none"
							viewBox="0 0 20 20"
							stroke="currentColor"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M7 10l5 5 5-5"></path>
						</svg>
					</button>

					<!-- Contenido desplegable -->
					<div id="dropdownContent" class="mt-2 hidden w-full space-y-2">
						<!-- To do bd -->
						<TextSidebar content="Ingl√©s" />
						<TextSidebar content="M√∫sica" />
						<TextSidebar content="F√≠sica" />
						<TextSidebar content="Franc√©s" />
						<TextSidebar content="Lat√≠n" />
						<TextSidebar content="Biolog√≠a" />
						<TextSidebar content="Anatom√≠a" />
						<TextSidebar content="Italiano" />
						<TextSidebar content="Filosof√≠a" />
						<TextSidebar content="Econom√≠a" />
					</div>
				</div>
			</div>

			<hr class="flex-grow border-b border-black" />
			<div class="mt-4 space-y-2">
				<h3 class="text-base font-bold">D√≠as:</h3>
				<TextSidebar content="Lunes" />
				<TextSidebar content="Martes" />
				<TextSidebar content="Mi√©rcoles" />
				<TextSidebar content="Jueves" />
				<TextSidebar content="Viernes" />
			</div>
			<div class="mt-6 flex items-center justify-center">
				<a href="/faqs" aria-label="Enlace que te lleva a la p√°gina de preguntas frecuentes"> </a>
			</div>
		</aside>

		<!-- Contenido Principal -->
		<section class="w-full p-4">
			<div class="my-8">
				<h2 class="mb-4 text-base font-bold md:text-2xl lg:text-2xl">Resultado de su b√∫squeda:</h2>
				<div class="scroll-container hidden overflow-x-hidden overflow-y-scroll lg:block">
					<hr class="mb-8 w-full border-b border-black" />
					<!-- To do bd -->
					<Border title="" dias="" ambito="" horario="" teacher="" precio="" />
					<Border title="" dias="" ambito="" horario="" teacher="" precio="" />
					<Border title="" dias="" ambito="" horario="" teacher="" precio="" />
					<Border title="" dias="" ambito="" horario="" teacher="" precio="" />
					<Border title="" dias="" ambito="" horario="" teacher="" precio="" />
					<div class="mb-7 ml-7 mr-7 flex w-full justify-end">
						<Button content="Inscribirse" disable={false} />
					</div>
				</div>
				<div class="sm:block lg:hidden">
					<hr class="mb-8 w-full border-b border-black" />
					<Border title="" dias="" ambito="" horario="" teacher="" precio="" />
					<Border title="" dias="" ambito="" horario="" teacher="" precio="" />
					<Border title="" dias="" ambito="" horario="" teacher="" precio="" />
					<Border title="" dias="" ambito="" horario="" teacher="" precio="" />
					<Border title="" dias="" ambito="" horario="" teacher="" precio="" />
					<div class="mb-7 flex w-full justify-end">
						<Button content="Inscribirse" disable={false} />
					</div>
				</div>
			</div>
		</section>
	</section>

	<Footer />
	<style>
		.scroll-container {
			max-height: 80vh;
			overflow-y: auto;
			margin-right: 80px;
			overflow-x: hidden;
		}

		.scroll-container::-webkit-scrollbar {
			width: 15px;
		}

		.scroll-container::-webkit-scrollbar-track {
			background: white;
		}

		.scroll-container::-webkit-scrollbar-thumb {
			background-color: #d9d9d9;
		}

		.scroll-container::-webkit-scrollbar-thumb:hover {
			background-color: var(--color-secondary);
		}
	</style>
</Layout>

<script>
	// Obtenemos referencias a los elementos del DOM
	const dropdownBtn = document.getElementById("dropdownBtn")
	const dropdownIcon = document.getElementById("dropdownIcon")
	const dropdownContent = document.getElementById("dropdownContent")
	const menuSection = document.getElementById("menuSection")
	const mobileMenuBtn = document.getElementById("mobileMenuBtn")

	let isOpen = false // Estado inicial del men√∫ desplegable

	// Funci√≥n para alternar la visibilidad del contenido desplegable y rotar el √≠cono
	function toggleDropdown() {
		isOpen = !isOpen // Cambiamos el estado del men√∫ desplegable
		dropdownContent.classList.toggle("hidden") // Alternamos la clase 'hidden' para mostrar/ocultar el contenido
		dropdownIcon.classList.toggle("rotate-180") // Rotamos el √≠cono de flecha (agregando o quitando la clase 'rotate-180')
		dropdownContent.classList.toggle("width:100%")
	}

	// Funci√≥n para mostrar u ocultar el men√∫ en dispositivos m√≥viles al hacer clic en el icono de hamburguesa
	function toggleMobileMenu() {
		menuSection.classList.toggle("hidden") // Alternamos la visibilidad del men√∫
	}

	// Agregamos event listeners a los botones para alternar el estado del contenido desplegable al hacer clic
	dropdownBtn.addEventListener("click", toggleDropdown)
	mobileMenuBtn.addEventListener("click", toggleMobileMenu)
</script>
